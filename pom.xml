# =============================================
# STEP 6: Deploy to CloudHub 2.0 (Single Command)
# =============================================
- script: |
    export M2_HOME=$(MAVEN_HOME)
    export PATH=$(MAVEN_HOME)/bin:$PATH
    
    echo "=================================================="
    echo " CloudHub 2.0 Deployment (Connected App)"
    echo "=================================================="
    echo "Runtime: 4.9.0"
    echo "Application: azure-project-v53"
    echo "Environment: Sandbox"
    echo "Target: Cloudhub-US-East-2"
    echo ""
    
    # ‚úÖ SINGLE COMMAND: Build + Deploy in one go
    mvn clean deploy \
      -Pcloudhub2 \
      -DskipTests \
      -Dmule.version=4.9.0 \
      -DanypointClientId=$(anypointClientId) \
      -DanypointClientSecret=$(anypointClientSecret) \
      -Dmule.env=dev \
      -Dsecure.key=mule \
      -s ~/.m2/settings.xml \
      -e
    
    if [ $? -eq 0 ]; then
      echo ""
      echo "=================================================="
      echo " ‚úÖ DEPLOYMENT SUCCESSFUL!"
      echo "=================================================="
      echo ""
      echo "Application: azure-project-v53"
      echo "Environment: Sandbox"
      echo "Target: Cloudhub-US-East-2"
      echo ""
      echo "üåê Check status at:"
      echo "   https://anypoint.mulesoft.com/cloudhub"
      echo ""
    else
      echo ""
      echo "=================================================="
      echo " ‚ùå DEPLOYMENT FAILED"
      echo "=================================================="
      exit 1
    fi
    
  displayName: 'Deploy to CloudHub 2.0 (Connected App)'
  env:
    M2_HOME: $(MAVEN_HOME)
    anypointClientId: $(anypointClientId)
    anypointClientSecret: $(anypointClientSecret)
